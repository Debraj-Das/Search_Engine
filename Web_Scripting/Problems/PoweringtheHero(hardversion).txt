Powering the Hero (hard version)                    

https://codeforces.com/problemset/problem/1800/C2

data structures

1100

This is a hard version of the problem. It differs from the easy one only by constraints on n and t.There is a deck of n cards, each of which is characterized by its power. There are two types of cards:  a hero card, the power of such a card is always equal to 0;  a bonus card, the power of such a card is always positive. You can do the following with the deck:  take a card from the top of the deck;  if this card is a bonus card, you can put it on top of your bonus deck or discard;  if this card is a hero card, then the power of the top card from your bonus deck is added to his power (if it is not empty), after that the hero is added to your army, and the used bonus discards. Your task is to use such actions to gather an army with the maximum possible total power.