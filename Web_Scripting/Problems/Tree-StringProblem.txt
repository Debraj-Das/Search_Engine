TreeString Problem                    

httpscodeforcescomproblemsetproblem291E

special problem

2000

A rooted tree is a nondirected connected graph without any cycles with a distinguished vertex which is called the tree root Consider the vertices of a rooted tree that consists of n vertices numbered from 1 to n In this problem the tree root is the vertex number 1Lets represent the length of the shortest by the number of edges path in the tree between vertices v and u as dvuA parent of vertex v in the rooted tree with the root in vertex r vr is vertex pv such that drpv1drv and dpvv1 For example on the picture the parent of vertex v5 is vertex p52One day Polycarpus came across a rooted tree consisting of n vertices The tree wasnt exactly ordinary it had strings written on its edges Polycarpus positioned the tree on the plane so as to make all edges lead from top to bottom if you go from the vertex parent to the vertex see the picture For any edge that lead from vertex pv to vertex v 1vn he knows string sv that is written on it All strings are written on the edges from top to bottom For example on the picture s7ba The characters in the strings are numbered starting from 0  An example of Polycarpuss tree corresponds to the example from the statement Polycarpus defines the position in this tree as a specific letter on a specific string The position is written as a pair of integers vx that means that the position is the xth letter of the string sv 1vn 0xsv where sv is the length of string sv For example the highlighted letters are positions 21 and 31Lets consider the pair of positions vx and uy in Polycarpus tree such that the way from the first position to the second goes down on each step We will consider that the pair of such positions defines string z String z consists of all letters on the way from vx to uy written in the order of this path For example in the picture the highlighted positions define string bacabaPolycarpus has a string t he wants to know the number of pairs of positions that define string t Note that the way from the first position to the second in the pair must go down everywhere Help him with this challenging treestring problem