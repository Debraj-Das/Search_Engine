Replace All                    

httpscodeforcescomproblemsetproblem794G

combinatorics

3400

Igor the analyst is at work He learned about a feature in his text editor called Replace All Igor is too bored at work and thus he came up with the following problemGiven two strings x and y which consist of the English letters A and B only a pair of strings st is called good if s and t consist of the characters 0 and 1 only 1stn where z denotes the length of string z and n is a fixed positive integer If we replace all occurrences of A in x and y with the string s and replace all occurrences of B in x and y with the string t then the two obtained from x and y strings are equal For example if xAAB yBB and n4 then 01 0101 is one of good pairs of strings because both obtained after replacing strings are 01010101The flexibility of a pair of strings x and y is the number of pairs of good strings st The pairs are ordered for example the pairs 0 1 and 1 0 are differentYoure given two strings c and d They consist of characters A B and  only Find the sum of flexibilities of all possible pairs of strings cd such that c and d can be obtained from c and d respectively by replacing the question marks with either A or B modulo 1097