Vlad and the Nice Paths (hard version)                    

https://codeforces.com/problemset/problem/1811/G2

binary search

2200

This is hard version of the problem, it differs from the easy one only by constraints on n and k.Vlad found a row of n tiles and the integer k. The tiles are indexed from left to right and the i-th tile has the color c_i. After a little thought, he decided what to do with it.You can start from any tile and jump to any number of tiles right, forming the path p. Let's call the path p of length m nice if:  p can be divided into blocks of length exactly k, that is, m is divisible by k;  c_{p_1} = c_{p_2} = \ldots = c_{p_k};  c_{p_{k+1}} = c_{p_{k+2}} = \ldots = c_{p_{2k}};  \ldots  c_{p_{m-k+1}} = c_{p_{m-k+2}} = \ldots = c_{p_{m}}; Your task is to find the number of nice paths of maximum length. Since this number may be too large, print it modulo 10^9 + 7.