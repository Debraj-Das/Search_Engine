Doremy's Perfect DS Class (Hard Version)                    

https://codeforces.com/problemset/problem/1764/G3

binary search

3300

The only difference between this problem and the other two versions is the maximum number of queries. In this version, you are allowed to ask at most \mathbf{20} queries. You can make hacks only if all versions of the problem are solved.This is an interactive problem."Everybody! Doremy's Perfect Data Structure Class is about to start! Come and do your best if you want to have as much IQ as me!" In today's Data Structure class, Doremy is teaching everyone a powerful data structure — Doremy tree! Now she gives you a quiz to prove that you are paying attention in class.Given an array a of length m, Doremy tree supports the query Q(l,r,k), where 1 \leq l \leq r \leq m and 1 \leq k \leq m, which returns the number of distinct integers in the array \left[\lfloor\frac{a_l}{k} \rfloor, \lfloor\frac{a_{l+1}}{k} \rfloor, \ldots, \lfloor\frac{a_r}{k} \rfloor\right].Doremy has a secret permutation p of integers from 1 to n. You can make queries, in one query, you give 3 integers l,r,k (1 \leq l \leq r \leq n, 1 \leq k \leq n) and receive the value of Q(l,r,k) for the array p. Can you find the index y (1 \leq y \leq n) such that p_y=1 in at most \mathbf{20} queries?Note that the permutation p is fixed before any queries are made.