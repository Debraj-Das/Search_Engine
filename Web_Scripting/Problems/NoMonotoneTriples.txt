No Monotone Triples                    

https://codeforces.com/problemset/problem/1332/G

data structures

3100

Given a sequence of integers a of length n, a tuple (i,j,k) is called monotone triples if   1 \le i<j<k\le n;  a_i \le a_j \le a_k or a_i \ge a_j \ge a_k is satisfied. For example, a=[5,3,4,5], then (2,3,4) is monotone triples for sequence a while (1,3,4) is not.Bob is given a sequence of integers a of length n in a math exam. The exams itself contains questions of form L, R, for each of them he is asked to find any subsequence b with size greater than 2 (i.e. |b| \ge 3) of sequence a_L, a_{L+1},\ldots, a_{R}.Recall that an sequence b is a subsequence of sequence a if b can be obtained by deletion of several (possibly zero, or all) elements.However, he hates monotone stuff, and he wants to find a subsequence free from monotone triples. Besides, he wants to find one subsequence with the largest length among all subsequences free from monotone triples for every query.Please help Bob find out subsequences meeting the above constraints.