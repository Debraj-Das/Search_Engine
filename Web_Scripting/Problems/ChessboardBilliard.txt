Chessboard Billiard                    

httpscodeforcescomproblemsetproblem74C

dfs and similar

2100

Lets imagine there is a chess piece billiard ball Its movements resemble the ones of a bishop chess piece The only difference is that when a billiard ball hits the boards border it can reflect from it and continue movingMore formally first one of four diagonal directions is chosen and the billiard ball moves in that direction When it reaches the square located on the boards edge the billiard ball reflects from it it changes the direction of its movement by 90 degrees and continues moving Specifically having reached a corner square the billiard ball is reflected twice and starts to move the opposite way While it moves the billiard ball can make an infinite number of reflections At any square of its trajectory the billiard ball can stop and on that the move is considered completed  It is considered that one billiard ball a beats another billiard ball b if a can reach a point where b is locatedYou are suggested to find the maximal number of billiard balls that pairwise do not beat each other and that can be positioned on a chessboard nm in size