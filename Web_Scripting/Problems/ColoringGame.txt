Coloring Game                    

httpscodeforcescomproblemsetproblem1197F

dp

2700

Alice and Bob want to play a game They have n colored paper strips the ith strip is divided into ai cells numbered from 1 to ai Each cell can have one of 3 colorsIn the beginning of the game Alice and Bob put n chips the ith chip is put in the aith cell of the ith strip Then they take turns Alice is first Each player during their turn has to choose one chip and move it 1 2 or 3 cells backwards ie if the current cell is x then the chip can be moved to the cell x  1 x  2 or x  3 There are two restrictions the chip cannot leave the borders of the strip for example if the current cell is 3 then you cant move the chip 3 cells backwards and some moves may be prohibited because of color of the current cell a matrix f with size 3 times 3 is given where fi j  1 if it is possible to move the chip j cells backwards from the cell which has color i or fi j  0 if such move is prohibited The player who cannot make a move loses the gameInitially some cells may be uncolored Bob can color all uncolored cells as he wants but he cannot leave any cell uncolored Lets call a coloring good if Bob can win the game no matter how Alice acts if the cells are colored according to this coloring Two colorings are different if at least one cell is colored in different colors in these two coloringsBob wants you to calculate the number of good colorings Can you do it for himSince the answer can be really large you have to print it modulo 998244353