Pasha and Pipe                    

httpscodeforcescomproblemsetproblem518F

binary search

2300

On a certain meeting of a ruling party A minister Pavel suggested to improve the sewer system and to create a new pipe in the cityThe city is an nm rectangular squared field Each square of the field is either empty then the pipe can go in it or occupied the pipe cannot go in such square Empty squares are denoted by character  occupied squares are denoted by character The pipe must meet the following criteria  the pipe is a polyline of width 1  the pipe goes in empty squares  the pipe starts from the edge of the field but not from a corner square  the pipe ends at the edge of the field but not in a corner square  the pipe has at most 2 turns 90 degrees  the border squares of the field must share exactly two squares with the pipe  if the pipe looks like a single segment then the end points of the pipe must lie on distinct edges of the field  for each nonborder square of the pipe there are exacly two sideadjacent squares that also belong to the pipe  for each border square of the pipe there is exactly one sideadjacent cell that also belongs to the pipe Here are some samples of allowed piping routes                                                                                                                                                                                Here are some samples of forbidden piping routes                                                                                                                                                                                In these samples the pipes are represented by characters You were asked to write a program that calculates the number of distinct ways to make exactly one pipe in the city The two ways to make a pipe are considered distinct if they are distinct in at least one square