Balanced Removals (Harder)                    

https://codeforces.com/problemset/problem/1237/C2

binary search

1900

This is a harder version of the problem. In this version, n \le 50\,000.There are n distinct points in three-dimensional space numbered from 1 to n. The i-th point has coordinates (x_i, y_i, z_i). The number of points n is even.You'd like to remove all n points using a sequence of \frac{n}{2} snaps. In one snap, you can remove any two points a and b that have not been removed yet and form a perfectly balanced pair. A pair of points a and b is perfectly balanced if no other point c (that has not been removed yet) lies within the axis-aligned minimum bounding box of points a and b.Formally, point c lies within the axis-aligned minimum bounding box of points a and b if and only if \min(x_a, x_b) \le x_c \le \max(x_a, x_b), \min(y_a, y_b) \le y_c \le \max(y_a, y_b), and \min(z_a, z_b) \le z_c \le \max(z_a, z_b). Note that the bounding box might be degenerate. Find a way to remove all points in \frac{n}{2} snaps.