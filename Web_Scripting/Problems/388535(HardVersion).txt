388535 (Hard Version)                    

https://codeforces.com/problemset/problem/1658/D2

bitmasks

2300

This is the hard version of the problem. The difference in the constraints between both versions are colored below in red. You can make hacks only if all versions of the problem are solved.Marin and Gojou are playing hide-and-seek with an array.Gojou initially perform the following steps:   First, Gojou chooses 2 integers l and r such that l \leq r.  Then, Gojou will make an array a of length r-l+1 which is a permutation of the array [l,l+1,\ldots,r].  Finally, Gojou chooses a secret integer x and sets a_i to a_i \oplus x for all i (where \oplus denotes the bitwise XOR operation). Marin is then given the values of l,r and the final array a. She needs to find the secret integer x to win. Can you help her?Note that there may be multiple possible x that Gojou could have chosen. Marin can find any possible x that could have resulted in the final value of a.