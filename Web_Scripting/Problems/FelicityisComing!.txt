Felicity is Coming                    

httpscodeforcescomproblemsetproblem757C

data structures

1900

Its that time of the year Felicity is around the corner and you can see people celebrating all around the Himalayan region The Himalayan region has n gyms The ith gym has gi Pokemon in it There are m distinct Pokemon types in the Himalayan region numbered from 1 to m There is a special evolution camp set up in the fest which claims to evolve any Pokemon The type of a Pokemon could change after evolving subject to the constraint that if two Pokemon have the same type before evolving they will have the same type after evolving Also if two Pokemon have different types before evolving they will have different types after evolving It is also possible that a Pokemon has the same type before and after evolving Formally an evolution plan is a permutation f of 12m such that fxy means that a Pokemon of type x evolves into a Pokemon of type yThe gym leaders are intrigued by the special evolution camp and all of them plan to evolve their Pokemons The protocol of the mountain states that in each gym for every type of Pokemon the number of Pokemon of that type before evolving any Pokemon should be equal the number of Pokemon of that type after evolving all the Pokemons according to the evolution plan They now want to find out how many distinct evolution plans exist which satisfy the protocolTwo evolution plans f1 and f2 are distinct if they have at least one Pokemon type evolving into a different Pokemon type in the two plans i e there exists an i such that f1if2iYour task is to find how many distinct evolution plans are possible such that if all Pokemon in all the gyms are evolved the number of Pokemon of each type in each of the gyms remains the same As the answer can be large output it modulo 1097