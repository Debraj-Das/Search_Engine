Survival of the Weakest (hard version)                    

https://codeforces.com/problemset/problem/1805/F2

greedy

3100

This is the hard version of the problem. It differs from the easy one only in constraints on n. You can make hacks only if you lock both versions.Let a_1, a_2, \ldots, a_n be an array of non-negative integers. Let F(a_1, a_2, \ldots, a_n) be the sorted in the non-decreasing order array of n - 1 smallest numbers of the form a_i + a_j, where 1 \le i < j \le n. In other words, F(a_1, a_2, \ldots, a_n) is the sorted in the non-decreasing order array of n - 1 smallest sums of all possible pairs of elements of the array a_1, a_2, \ldots, a_n. For example, F(1, 2, 5, 7) = [1 + 2, 1 + 5, 2 + 5] = [3, 6, 7].You are given an array of non-negative integers a_1, a_2, \ldots, a_n. Determine the single element of the array \underbrace{F(F(F\ldots F}_{n-1}(a_1, a_2, \ldots, a_n)\ldots)). Since the answer can be quite large, output it modulo 10^9+7.