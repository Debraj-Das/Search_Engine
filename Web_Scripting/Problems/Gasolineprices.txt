Gasoline prices                    

https://codeforces.com/problemset/problem/1801/E

data structures

3000

 Berland — is a huge country consisting of n cities. The road network of Berland can be represented as a root tree, that is, there is only n - 1 road in the country, and you can get from any city to any other exactly one way, if you do not visit any city twice. For the convenience of representing the country, for each city i, the city p_i is fixed, equal to the first city to which you need to go from the city i to get to the city 1. In other words, the city p_i is equal to the ancestor of the city i if the tree is hung for the city 1.There is one gas station in each city of Berland. Gas stations have special pricing, and for each gas station there is a fixed range of prices for which they are ready to sell gasoline. A gas station in the city with the number i is ready to sell gasoline at any price from l_i to r_i inclusive.The King of Berland — is an exemplary family man, and for m years, two sons were born to him every year. The king's children have been involved in public affairs since early childhood, and at the end of each year they check the honesty of gasoline prices. From birth, the king's children, who are born in the year i, are responsible for checking gasoline prices on the ways from the city of a_i to the city of b_i and from the city of c_i to the city of d_i, respectively.The check is as follows: both children simultaneously start their journey from the cities a_i and c_i, respectively. The first son of the king, born in the year i, moves along the path from the city a_i to the city b_i, and the second  — from the city c_i to the city d_i. Children check that the price of gasoline in the city of a_i coincides with the price of gasoline in the city of c_i. Next, they check that the price of gasoline in the second city on the way from a_i to b_i coincides with the price in the second city on the way from c_i to d_i. Then they repeat the same thing for a couple of third cities on their paths and so on. At the end, they check that the price of gasoline in the city of b_i coincides with the price of gasoline in the city of d_i. It is guaranteed that the length of the path from the city a_i to the city b_i coincides with the length of the path from the city c_i to the city d_i.Gas stations must strictly obey the laws, and therefore all checks of gasoline prices should not reveal violations. Help Berland gas stations find out how many ways they can set gasoline prices for m years. In other words, for each i from 1 to m, calculate how many ways you can set gasoline prices at all gas stations so that after the birth of the first i pairs of the king's children, all their checks did not reveal violations, and at any gas station the price was in the acceptable price range. Since the number of such methods can be large, calculate the answer modulo 10^9 + 7. 