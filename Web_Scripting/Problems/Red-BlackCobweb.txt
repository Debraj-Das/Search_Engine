RedBlack Cobweb                    

httpscodeforcescomproblemsetproblem833D

data structures

2800

  Slastyona likes to watch life of nearby groves dwellers This time she watches a strange redblack spider sitting at the center of a huge cobwebThe cobweb is a set of n nodes connected by threads each of the treads is either red of black Using these threads the spider can move between nodes No thread connects a node to itself and between any two nodes there is a unique sequence of threads connecting themSlastyona decided to study some special qualities of the cobweb She noticed that each of the threads has a value of clamminess xHowever Slastyona is mostly interested in jelliness of the cobweb Consider those of the shortest paths between each pair of nodes on which the numbers of red and black threads differ at most twice For each such path compute the product of the clamminess of threads on the pathThe jelliness of the cobweb is the product of all obtained values among all paths Those paths that differ by direction only are counted only onceOf course this number can be huge so Slastyona asks you to compute the jelliness of the given cobweb and print the answer modulo 1097